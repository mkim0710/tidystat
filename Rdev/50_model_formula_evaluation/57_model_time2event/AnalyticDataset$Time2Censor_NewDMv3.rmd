---
title: "MHKim's R Notebook"
output: html_notebook
    df_print: tibble
---

# _______________
Rstudio RMarkDown Shortcuts
https://support.posit.co/hc/en-us/articles/200711853-Keyboard-Shortcuts-in-the-RStudio-IDE
https://bookdown.org/yihui/rmarkdown-cookbook/rstudio-shortcuts.html
Insert R chunk	Ctrl+Alt+I	Command+Option+I
Preview HTML	Ctrl+Shift+K	Command+Shift+K
Run all chunks above	Ctrl+Alt+P	Command+Option+P
Run current chunk	Ctrl+Alt+C	Command+Option+C
Run current chunk	Ctrl+Shift+Enter	Command+Shift+Enter
Run next chunk	Ctrl+Alt+N	Command+Option+N
Run all chunks	Ctrl+Alt+R	Command+Option+R
Go to next chunk/title	Ctrl+PgDown	Command+PgDown
Go to previous chunk/title	Ctrl+PgUp	Command+PgUp
Show/hide document outline	Ctrl+Shift+O	Command+Shift+O
F7 spell-check your document. 
Restart the R session   Ctrl + Alt + F10 (or Command + Option + F10 on macOS). 


```{r, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
# as1_7.na.Date.fct.cumulative_DM.list |> str(max.level = 2)
# # > as1_7.na.Date.fct.cumulative_DM.list |> str(max.level = 2)
# # List of 7
# #  $ DM_C     :List of 2
# #   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #  $ GLU0_TR  :List of 2
# #   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #  $ GLU60_TR :List of 2
# #   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #  $ GLU120_TR:List of 2
# #   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #  $ HBA1C    :List of 2
# #   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #  $ DRUGDM   :List of 2
# #   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #  $ DRUGINS  :List of 2
# #   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
as1_7.na.Date.fct.cumulative_DM.list$EverDMv3_byWavei = as1_7.na.Date.fct.EverDMv3_byWavei |> set_names(paste0("EverDMv3_byWave", 1:7))
as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei = as1_7.na.Date.fct.NewDMv3_atWavei |> set_names(paste0("NewDMv3_atWave", 1:7))
as1_7.na.Date.fct.cumulative_DM.list |> str(max.level = 2)
as1_7.na.Date.fct.cumulative_DM.list$EverDMv3_byWavei |> str(max.level = 2)
as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> str(max.level = 2)
# > as1_7.na.Date.fct.cumulative_DM.list |> str(max.level = 2)
# List of 9
#  $ DM_C            :List of 2
#   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ GLU0_TR         :List of 2
#   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ GLU60_TR        :List of 2
#   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ GLU120_TR       :List of 2
#   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ HBA1C           :List of 2
#   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ DRUGDM          :List of 2
#   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ DRUGINS         :List of 2
#   ..$ df_wave           : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#   ..$ df_wave_cumulative: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ EverDMv3_byWavei: tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ NewDMv3_atWavei : tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# > as1_7.na.Date.fct.cumulative_DM.list$EverDMv3_byWavei |> str(max.level = 2)
# tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ EverDMv3_byWave1: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ EverDMv3_byWave2: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ EverDMv3_byWave3: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ EverDMv3_byWave4: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ EverDMv3_byWave5: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ EverDMv3_byWave6: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ EverDMv3_byWave7: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
# > as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> str(max.level = 2)
# tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
#  $ NewDMv3_atWave1: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ NewDMv3_atWave2: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
#  $ NewDMv3_atWave3: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
#  $ NewDMv3_atWave4: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
#  $ NewDMv3_atWave5: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
#  $ NewDMv3_atWave6: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
#  $ NewDMv3_atWave7: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
```


# \$ -dev as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 -----
```{r, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
# as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> str(max.level = 2)
# # > as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> str(max.level = 2)
# # tibble [10,030 × 7] (S3: tbl_df/tbl/data.frame)
# #  $ NewDMv3_atWave1: logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
# #  $ NewDMv3_atWave2: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
# #  $ NewDMv3_atWave3: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
# #  $ NewDMv3_atWave4: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
# #  $ NewDMv3_atWave5: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
# #  $ NewDMv3_atWave6: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
# #  $ NewDMv3_atWave7: logi [1:10030] FALSE FALSE FALSE FALSE FALSE FALSE ...
# as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> summary()
# # NewDMv3_atWave1 NewDMv3_atWave2 NewDMv3_atWave3 NewDMv3_atWave4 NewDMv3_atWave5 NewDMv3_atWave6 NewDMv3_atWave7
# # Mode :logical   Mode :logical   Mode :logical   Mode :logical   Mode :logical   Mode :logical   Mode :logical  
# # FALSE:8845      FALSE:9892      FALSE:9876      FALSE:9894      FALSE:9844      FALSE:9884      FALSE:9891     
# # TRUE :1185      TRUE :138       TRUE :154       TRUE :136       TRUE :186       TRUE :146       TRUE :139      
as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> 
    transmute(Time2Event_NewDMv3 = case_when(
        NewDMv3_atWave1 == TRUE ~ 1,
        NewDMv3_atWave2 == TRUE ~ 2,
        NewDMv3_atWave3 == TRUE ~ 3,
        NewDMv3_atWave4 == TRUE ~ 4,
        NewDMv3_atWave5 == TRUE ~ 5,
        NewDMv3_atWave6 == TRUE ~ 6,
        NewDMv3_atWave7 == TRUE ~ 7,
        TRUE ~ NA_real_
    )) %>% 
    table(useNA="always") |> addmargins
# Time2Event_NewDMv3
#     1     2     3     4     5     6     7  <NA>   Sum 
#  1185   138   154   136   186   146   139  7946 10030 

as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> 
    transmute(Time2Event_NewDMv3 = case_when(
        NewDMv3_atWave1 == TRUE ~ 1,
        NewDMv3_atWave2 == TRUE ~ 2,
        NewDMv3_atWave3 == TRUE ~ 3,
        NewDMv3_atWave4 == TRUE ~ 4,
        NewDMv3_atWave5 == TRUE ~ 5,
        NewDMv3_atWave6 == TRUE ~ 6,
        NewDMv3_atWave7 == TRUE ~ 7,
        TRUE ~ NA_real_
    )) |> 
    transmute(
        Event_NewDMv3 = !is.na(Time2Event_NewDMv3)
        , Time2Censor_NewDMv3 = replace_na(Time2Event_NewDMv3, 7)
    ) %>% 
    table(useNA="always") |> addmargins
#              Time2Censor_NewDMv3
# Event_NewDMv3     1     2     3     4     5     6     7  <NA>   Sum
#         FALSE     0     0     0     0     0     0  7946     0  7946
#         TRUE   1185   138   154   136   186   146   139     0  2084
#         <NA>      0     0     0     0     0     0     0     0     0
#         Sum    1185   138   154   136   186   146  8085     0 10030
```


# \$ as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 -----
```{r, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 =
    as1_7.na.Date.fct.cumulative_DM.list$NewDMv3_atWavei |> 
    transmute(Time2Event_NewDMv3 = case_when(
        NewDMv3_atWave1 == TRUE ~ 1,
        NewDMv3_atWave2 == TRUE ~ 2,
        NewDMv3_atWave3 == TRUE ~ 3,
        NewDMv3_atWave4 == TRUE ~ 4,
        NewDMv3_atWave5 == TRUE ~ 5,
        NewDMv3_atWave6 == TRUE ~ 6,
        NewDMv3_atWave7 == TRUE ~ 7,
        TRUE ~ NA_real_
    )) |> 
    transmute(
        Event_NewDMv3 = !is.na(Time2Event_NewDMv3)
        , Time2Censor_NewDMv3 = replace_na(Time2Event_NewDMv3, 7)
    )
as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 %>% {cat(" > ",deparse(substitute(.))," |> str()","\n", sep=""); str(.)}
as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 |> summary()
as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 |> table(useNA="always") |> addmargins
# > as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 %>% {cat(" > ",deparse(substitute(.))," |> str()","\n", sep=""); str(.)}
# tibble [10,030 × 2] (S3: tbl_df/tbl/data.frame)
#  $ Event_NewDMv3      : logi [1:10030] FALSE FALSE FALSE TRUE FALSE FALSE ...
#  $ Time2Censor_NewDMv3: num [1:10030] 7 7 7 1 7 7 7 7 1 7 ...
# > as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 |> summary()
#  Event_NewDMv3   Time2Censor_NewDMv3
#  Mode :logical   Min.   :1.000      
#  FALSE:7946      1st Qu.:7.000      
#  TRUE :2084      Median :7.000      
#                  Mean   :6.069      
#                  3rd Qu.:7.000      
#                  Max.   :7.000      
# > as1_7.na.Date.fct.cumulative_DM.list$Time2Censor_NewDMv3 |> table(useNA="always") |> addmargins
#              Time2Censor_NewDMv3
# Event_NewDMv3     1     2     3     4     5     6     7  <NA>   Sum
#         FALSE     0     0     0     0     0     0  7946     0  7946
#         TRUE   1185   138   154   136   186   146   139     0  2084
#         <NA>      0     0     0     0     0     0     0     0     0
#         Sum    1185   138   154   136   186   146  8085     0 10030
```


