# f_df.ExposedUnexposed.list.dev.r

f_df.ExposedUnexposed.list = function(data, varname_Exposed = "isExposed", rm_zero_vars = T) {
    # .packagename = "tidyverse"; if (!paste0("package:",.packagename) %in% search()) {library(.packagename, character.only = TRUE)}
    # source("https://raw.githubusercontent.com/mkim0710/tidystat/master/f_df.ExposedUnexposed.list.dev.r")
    if(!is.logical(data[[varname_Exposed]])) {
        stop("error - !is.logical(data[[varname_Exposed]])")
    }
    if(rm_zero_vars == T) {
        data2 = data[, which( 
            colSums( data[data[[varname_Exposed]] == T, ] %>% map_df(as.numeric) ) != 0 &
                colSums( data[data[[varname_Exposed]] == F, ] %>% map_df(as.numeric) ) != 0
        )]
        data2[[varname_Exposed]] = data[[varname_Exposed]]
    } else {
        data2 = data
    }
    print("* Dropping variables with all-zero values, either in the Exposed or the Unexposed:")
    dput(setdiff(names(data), names(data2)))
    # function.deparse.cat.width(setdiff(names(data), names(data2)))
    rm(data)
    
    f_df.ExposedUnexposed.list = list()
    f_df.ExposedUnexposed.list$Exposed = data2[data2[[varname_Exposed]] == T, ]
    f_df.ExposedUnexposed.list$Unexposed = data2[data2[[varname_Exposed]] == F, ]
    # print("* dim(data2)")
    # print(dim(data2))
    rm(data2)
    
    f_df.ExposedUnexposed.list
}


# #@ test --------  
load(url("https://raw.githubusercontent.com/mkim0710/tidystat/master/data/library_Matching_lalonde.rda"))
lalonde$isExposed = lalonde$treat == 1
str(lalonde)
# > str(lalonde)
# 'data.frame':	445 obs. of  13 variables:
#  $ age    : int  37 22 30 27 33 22 23 32 22 33 ...
#  $ educ   : int  11 9 12 11 8 9 12 11 16 12 ...
#  $ black  : int  1 0 1 1 1 1 1 1 1 0 ...
#  $ hisp   : int  0 1 0 0 0 0 0 0 0 0 ...
#  $ married: int  1 0 0 0 0 0 0 0 0 1 ...
#  $ nodegr : int  1 1 0 1 1 1 0 1 0 0 ...
#  $ re74   : num  0 0 0 0 0 0 0 0 0 0 ...
#  $ re75   : num  0 0 0 0 0 0 0 0 0 0 ...
#  $ re78   : num  9930 3596 24910 7506 290 ...
#  $ u74    : int  1 1 1 1 1 1 1 1 1 1 ...
#  $ u75    : int  1 1 1 1 1 1 1 1 1 1 ...
#  $ treat  : int  1 1 1 1 1 1 1 1 1 1 ...
#  $ isExposed : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
str(f_df.ExposedUnexposed.list(lalonde, varname_Exposed = "isExposed", rm_zero_vars = T))
# > str(f_df.ExposedUnexposed.list(lalonde, varname_Exposed = "isExposed", rm_zero_vars = T))
# [1] "* Dropping variables with all-zero values, either in the Exposed or the Unexposed:"
# "treat"
# List of 2
#  $ Exposed:'data.frame':	185 obs. of  12 variables:
#   ..$ age    : int [1:185] 37 22 30 27 33 22 23 32 22 33 ...
#   ..$ educ   : int [1:185] 11 9 12 11 8 9 12 11 16 12 ...
#   ..$ black  : int [1:185] 1 0 1 1 1 1 1 1 1 0 ...
#   ..$ hisp   : int [1:185] 0 1 0 0 0 0 0 0 0 0 ...
#   ..$ married: int [1:185] 1 0 0 0 0 0 0 0 0 1 ...
#   ..$ nodegr : int [1:185] 1 1 0 1 1 1 0 1 0 0 ...
#   ..$ re74   : num [1:185] 0 0 0 0 0 0 0 0 0 0 ...
#   ..$ re75   : num [1:185] 0 0 0 0 0 0 0 0 0 0 ...
#   ..$ re78   : num [1:185] 9930 3596 24910 7506 290 ...
#   ..$ u74    : int [1:185] 1 1 1 1 1 1 1 1 1 1 ...
#   ..$ u75    : int [1:185] 1 1 1 1 1 1 1 1 1 1 ...
#   ..$ isExposed : logi [1:185] TRUE TRUE TRUE TRUE TRUE TRUE ...
#  $ Unexposed:'data.frame':	260 obs. of  12 variables:
#   ..$ age    : int [1:260] 23 26 22 18 45 18 24 34 24 36 ...
#   ..$ educ   : int [1:260] 10 12 9 9 11 9 8 11 4 10 ...
#   ..$ black  : int [1:260] 1 0 1 1 1 1 0 1 0 1 ...
#   ..$ hisp   : int [1:260] 0 0 0 0 0 0 0 0 1 0 ...
#   ..$ married: int [1:260] 0 0 0 0 0 0 0 1 0 0 ...
#   ..$ nodegr : int [1:260] 1 0 1 1 1 1 1 1 1 1 ...
#   ..$ re74   : num [1:260] 0 0 0 0 0 0 0 0 0 0 ...
#   ..$ re75   : num [1:260] 0 0 0 0 0 0 0 0 0 0 ...
#   ..$ re78   : num [1:260] 0 12384 0 10740 11796 ...
#   ..$ u74    : int [1:260] 1 1 1 1 1 1 1 1 1 1 ...
#   ..$ u75    : int [1:260] 1 1 1 1 1 1 1 1 1 1 ...
#   ..$ isExposed : logi [1:260] FALSE FALSE FALSE FALSE FALSE FALSE ...

.packagename = "tableone"; if (!paste0("package:",.packagename) %in% search()) {library(.packagename, character.only = TRUE)}
lalonde %>% CreateTableOne(strata = "isExposed", data = ., test=F, includeNA = T) |> print(smd = T, nonnormal = "age")
# > lalonde %>% CreateTableOne(strata = "isExposed", data = ., test=F, includeNA = T) |> print(smd = T, nonnormal = "age")
#                       Stratified by isExposed
#                        FALSE                  TRUE                   SMD   
#   n                        260                    185                      
#   age (median [IQR])     24.00 [19.00, 28.00]   25.00 [20.00, 29.00]  0.107
#   educ (mean (sd))       10.09 (1.61)           10.35 (2.01)          0.141
#   black (mean (sd))       0.83 (0.38)            0.84 (0.36)          0.044
#   hisp (mean (sd))        0.11 (0.31)            0.06 (0.24)          0.175
#   married (mean (sd))     0.15 (0.36)            0.19 (0.39)          0.094
#   nodegr (mean (sd))      0.83 (0.37)            0.71 (0.46)          0.304
#   re74 (mean (sd))     2107.03 (5687.91)      2095.57 (4886.62)       0.002
#   re75 (mean (sd))     1266.91 (3102.98)      1532.06 (3219.25)       0.084
#   re78 (mean (sd))     4554.80 (5483.84)      6349.15 (7867.40)       0.265
#   u74 (mean (sd))         0.75 (0.43)            0.71 (0.46)          0.094
#   u75 (mean (sd))         0.68 (0.47)            0.60 (0.49)          0.177
#   treat (mean (sd))       0.00 (0.00)            1.00 (0.00)          Inf  
#   isExposed = TRUE (%)       0 (0.0)              185 (100.0)         NaN  



# @@ END----  