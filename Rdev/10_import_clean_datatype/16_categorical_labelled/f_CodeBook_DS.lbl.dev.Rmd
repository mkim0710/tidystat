---
# https://forum.posit.co/t/when-to-use-yaml-vs-when-to-use-setup-code-chunk/56169/
title: "`r params$doc_title`"
author: "MHKim"
date: "`r Sys.setlocale('LC_ALL', 'en_US.utf8'); format(Sys.time(), '%B %d, %Y')`"
output:
  html_notebook:  
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: false
      smooth_scroll: false
    number_sections: false
    code_folding: none
    df_print: tibble
    highlight: textmate
    fig_width: 10
    fig_height: 6
  html_document:
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: false
      smooth_scroll: false
    number_sections: false
    df_print: tibble
    code_folding: none
    highlight: textmate
    fig_width: 10
    fig_height: 6
  pdf_document: 
    toc: yes
    toc_depth: 6
    fig_width: 10
    fig_height: 6
    latex_engine: xelatex  # mainfont, sansfont, monofont, mathfont works only with xelatex and lualatex, but not pdflatex
    keep_tex: true
  word_document:
    toc: yes
    toc_depth: 6
    fig_width: 9
    fig_height: 6
# documentclass: scrartcl  # https://pandoc.org/MANUAL.html#variables-for-latex
# classoption: fontsize=9pt 
geometry: portrait, a3paper, margin=20mm # https://bookdown.org/yihui/rmarkdown/pdf-document.html#latex-options
# fontsize: 12pt
header-includes: 
  - \usepackage{fontspec}
  - \newcommand{\setfallbackfont}[4]{
      \IfFontExistsTF{#2}
        {#1{#2}}
        {\IfFontExistsTF{#3}
          {#1{#3}}
          {#1{#4}}}}
  # - \setfallbackfont{\setmainfont}{Roboto Condensed}{Noto Sans Condensed}{Arial Narrow}
  # - \setfallbackfont{\setsansfont}{Roboto Condensed}{Noto Sans Condensed}{Arial Narrow}
  - \setfallbackfont{\setmainfont}{Roboto}{Noto Sans}{Arial}
  - \setfallbackfont{\setsansfont}{Roboto}{Noto Sans}{Arial}
  - \setfallbackfont{\setmonofont}{Cascadia Code SemiBold}{Cascadia Code}{Fira Code}
  - \usepackage[hangul]{kotex}
  # - \setfallbackfont{\setmainhangulfont}{NanumGothic}{HCR Dotum LVT}{Malgun Gothic}
  # - \setfallbackfont{\setsanshangulfont}{NanumGothic}{HCR Dotum LVT}{Malgun Gothic}
  # - \setfallbackfont{\setmonohangulfont}{D2Coding}{NanumGothicCoding}{NanumGothic}
params:
  doc_title: !r basename(rstudioapi::getSourceEditorContext()$path)
# https://stackoverflow.com/questions/55751815/r-markdown-difference-between-parameters-and-variables
# ?rmarkdown::html_document
---
<!-- https://stackoverflow.com/questions/28480625/r-knitr-markown-setting-html-page-width -->
<style type="text/css">
.main-content, .toc {max-width: 785px; margin: 0 auto; font-size: 1rem;} /* A4: 21cm x 29.7cm = 8.27in x 11.69in; 8.27in x 96px/in ≈ 793px */
html { font-size: 12px; }
body { font-size: 12px; font-family: 'Roboto Condensed', 'Noto Sans Condensed', 'Open Sans Condensed', 'Source Sans 3', 'Arial Narrow', Helvetica, sans-serif; }
h1.title { font-size: 28px; font-family: 'Roboto Serif', 'Noto Serif', 'Source Serif 4', serif; line-height: 1.1; margin-top: 14px; margin-bottom: 0; color: Navy; }
h1 { font-size: 24px; font-family: 'Roboto Serif', 'Noto Serif', 'Source Serif 4', serif; line-height: 1.1; margin-top: 12px; margin-bottom: 0; color: Navy; }
h2 { font-size: 21px; font-family: 'Roboto Serif', 'Noto Serif', 'Source Serif 4', serif; line-height: 1.1; margin-top: 11px; margin-bottom: 0; color: Navy; }
h3 { font-size: 18px; font-family: 'Roboto Serif', 'Noto Serif', 'Source Serif 4', serif; line-height: 1.1; margin-top: 9px; margin-bottom: 0; color: Navy; }
h4 { font-size: 16px; font-family: 'Roboto Serif', 'Noto Serif', 'Source Serif 4', serif; line-height: 1.1; margin-top: 8px; margin-bottom: 0; color: Navy; }
h5 { font-size: 14px; font-family: 'Roboto Serif', 'Noto Serif', 'Source Serif 4', serif; line-height: 1.1; margin-top: 7px; margin-bottom: 0; color: Navy; }
h6 { font-size: 12px; font-family: 'Roboto Serif', 'Noto Serif', 'Source Serif 4', serif; line-height: 1.1; margin-top: 6px; margin-bottom: 0; color: Navy; }
table, td, th, figure, figcaption { font-size: 10px; font-family: 'Roboto Condensed', 'Noto Sans Condensed', 'Open Sans Condensed', 'Source Sans 3', 'Arial Narrow', Helvetica, sans-serif; line-height: 1.1; margin-top: 5px; margin-bottom: 0; }
code { font-size: 11px; font-family: 'Cascadia Code SemiBold', 'Cascadia Code', 'Fira Code', Consolas, 'Source Code Pro', monospace; line-height: 1.1; margin-top: 6px; margin-bottom: 0; color: DimGray; background-color: Snow; }
pre { font-size: 11px; font-family: 'Cascadia Code SemiBold', 'Cascadia Code', 'Fira Code', Consolas, 'Source Code Pro', monospace; line-height: 1.1; margin-top: 6px; margin-bottom: 0; color: DimGray; background-color: Snow; }
</style>
  
<!-- font-size: 0.9em; /* 90% of inherited font size */ -->
  
<!-- Body text (body): The default font size is typically 16 pixels. -->
<!-- Paragraphs (p): Inherit the body's font size, so also typically 16 pixels. -->
<!-- List items (li): Inherit the body's font size, generally 16 pixels. -->
<!-- Headings (h1 to h6): The default sizes decrease with each level. For example: -->
<!-- h1: Typically around 32 pixels. -->
<!-- h2: Often around 24 pixels. -->
<!-- h3: Commonly around 18.72 pixels. -->
<!-- h4: Usually about 16 pixels. -->
<!-- h5: Generally around 13.28 pixels. -->
<!-- h6: Often about 10.72 pixels. -->
<!-- Blockquotes (blockquote): Usually inherit the body's font size, around 16 pixels. -->
<!-- Tables (table), table cells (td, th): Typically inherit the body's font size, so around 16 pixels. -->
<!-- Figures (figure) and figure captions (figcaption): Generally inherit the body's font size, so about 16 pixels. -->
<!-- 1: Approximately 8 pixels. -->
<!-- 2: Approximately 10 pixels. -->
<!-- 3: Approximately 12 pixels (this was often considered the default size). -->
<!-- 4: Approximately 14 pixels. -->
<!-- 5: Approximately 18 pixels. -->
<!-- 6: Approximately 24 pixels. -->
# __________|------  
<!-- {r Rstudio-RMarkDown-Shortcuts, eval=FALSE, include=FALSE} -->
<!-- ##### Rstudio RMarkDown Shortcuts -->
<!-- https://support.posit.co/hc/en-us/articles/200711853-Keyboard-Shortcuts-in-the-RStudio-IDE   -->
<!-- https://bookdown.org/yihui/rmarkdown-cookbook/rstudio-shortcuts.html   -->
<!-- Insert R chunk	Ctrl+Alt+I	Command+Option+I   -->
<!-- Preview HTML	Ctrl+Shift+K	Command+Shift+K   -->
<!-- Run all chunks above	Ctrl+Alt+P	Command+Option+P   -->
<!-- Run current chunk	Ctrl+Alt+C	Command+Option+C   -->
<!-- Run current chunk	Ctrl+Shift+Enter	Command+Shift+Enter   -->
<!-- Run next chunk	Ctrl+Alt+N	Command+Option+N   -->
<!-- Run all chunks	Ctrl+Alt+R	Command+Option+R   -->
<!-- Go to next chunk/title	Ctrl+PgDown	Command+PgDown   -->
<!-- Go to previous chunk/title	Ctrl+PgUp	Command+PgUp   -->
<!-- Show/hide document outline	Ctrl+Shift+O	Command+Shift+O   -->
<!-- F7 spell-check your document.   -->
<!-- Restart the R session   Ctrl + Alt + F10 (or Command + Option + F10 on macOS).   -->
<!--    -->
<!-- *** Caution: @ # \$ \% * \\ ***  -->

  
```{r setup, echo=FALSE, results="hide"}
## Cf) {r setup, eval=TRUE, include=FALSE}
if(Sys.info()["sysname"] == "Windows") Sys.setlocale("LC_ALL", "en_US.UTF-8")  # Note that setting category "LC_ALL" sets only categories "LC_COLLATE", "LC_CTYPE", "LC_MONETARY" and "LC_TIME".
# Sys.setlocale("LC_MESSAGES", "en_US.utf8")  # Note that the LANGUAGE environment variable has precedence over "LC_MESSAGES" in selecting the language for message translation on most R platforms.  # LC_MESSAGES does not exist in Windows
Sys.setenv(LANGUAGE="en_US");  # Sys.getenv("LANGUAGE");    # Note that the LANGUAGE environment variable has precedence over "LC_MESSAGES" in selecting the language for message translation on most R platforms.
# str(knitr::opts_chunk$get())
# cat(deparse(knitr::opts_chunk$get(), width.cutoff=120), "  \n", sep="")
# list(eval=TRUE, echo=TRUE, results = "markup", tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = "##",     highlight = TRUE, size = "normalsize", background = "#F7F7F7", strip.white = structure(TRUE, class = "AsIs"), cache = FALSE,     cache.path = "cache/", cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, autodep = FALSE, cache.rebuild = FALSE,     fig.keep = "high", fig.show = "asis", fig.align = "default", fig.path = "figure/", dev = NULL, dev.args = NULL, dpi = 72,     fig.ext = NULL, fig.width=7, fig.height=7, fig.env = "figure", fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:",     fig.subcap = NULL, fig.pos = "", out.width=NULL, out.height=NULL, out.extra = NULL, fig.retina = 1, external = TRUE,     sanitize = FALSE, interval = 1, aniopts = "controls,loop", warning = TRUE, error = TRUE, message = TRUE, render = NULL,     ref.label = NULL, child = NULL, engine = "R", split = FALSE, include = TRUE, purl = TRUE)
knitr::opts_chunk$set(
    eval=TRUE, echo=FALSE, results="markup", collapse=TRUE, # In Rstudio Notebook Source Pane & nb.HTML, results="hold" does not work
    comment="#", fig.width=10, fig.height=6, # In Rstudio Notebook Source Pane & nb.HTML, comment="##" does not work?
    warning=TRUE, message=TRUE, include=TRUE, 
    error=FALSE,  # error=TRUE: show the errors without stopping R; error=FALSE: stop on error
    tidy.opts=list(width.cutoff=120), tidy=FALSE, 
    R.options = list(width=120), paged.print=FALSE
) 
# knitr::opts_chunk$set(message=TRUE) & {r, results="hide"} -> message shown in Rstudio Notebook Source Pane & knitted HTML, but not in Preview nb.HTML?!
# knitr::opts_chunk$set(message=FALSE) & {r, message=TRUE, results="hide"} -> message shown in Rstudio Notebook Source Pane & knitted HTML, but not in Preview nb.HTML?!
# *** results="hide": results shown only on Rstudio Notebook Source Pane, but not in nb.HTML nor knitted HTML
knitr::opts_knit$set(global.par = TRUE)


## Cf) {r loadPackages-NoEchoHideResults, echo=FALSE, results="hide"}
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
# cmd /C C:/PROGRA~2/MICROS~1/Edge/APPLIC~1/msedge_proxy.exe --app=https://github.com/mkim0710/tidystat/blob/master/rstudio-prefs/templates/default.R
# cmd /C C:/PROGRA~2/MICROS~1/Edge/APPLIC~1/msedge_proxy.exe --app=https://github.com/mkim0710/tidystat/blob/master/rstudio-prefs/templates/templates-00env1.minimum.Rmd
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
# cmd /C C:/PROGRA~2/MICROS~1/Edge/APPLIC~1/msedge_proxy.exe --app=https://github.com/mkim0710/tidystat/blob/master/.Rprofile    
#| ------------------------- < To be covered at .Rprofile > --------------------- |#  
if(!exists("env1", envir=.GlobalEnv)) {  message('> source("https://raw.githubusercontent.com/mkim0710/tidystat/master/.Rprofile")')  ;  source("https://raw.githubusercontent.com/mkim0710/tidystat/master/.Rprofile")  ;  .First()  }  
if(!".Rprofile" %in% names(.GlobalEnv$env1$source)) {  message('> source("https://raw.githubusercontent.com/mkim0710/tidystat/master/.Rprofile")')  ;  source("https://raw.githubusercontent.com/mkim0710/tidystat/master/.Rprofile")  ;  .First()  }  
##________________________________________________________________________________  
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
env1$info$options.width = getOption("width"); cat('\tgetOption("width") == ', env1$info$options.width, "  \n", sep="")
#   
## Cf) {r env1-Info-NoEchoHideResults, echo=FALSE, results="hide"}
# https://yihui.org/knitr/options/#package-options
env1$info$info_software_versions = env1$env.internal.attach$get_software_versions(library_names = c("tidyverse", "dplyr", "ggplot2", "purrr", "stringr", "stats","survival"))
# str(env1$info$info_software_versions)


###### env1\$info\$DocumentTitle1 ----  
# ```{r env1-DocumentTitle1-NoEchoHideResults, echo=FALSE, results="hide"}
env1$info$DocumentTitle0 = paste0("00env1.minimum","-",basename(getwd()))
env1$info$DocumentTitle1 = paste0(env1$info$DocumentTitle0,"@", ifelse(grepl("MacBook-Pro", Sys.info()["nodename"]), "MBP", Sys.info()["nodename"]))
cat(env1$info$DocumentTitle0,"-",format(Sys.time(),"%y%m%d"), "\n", 
    env1$info$DocumentTitle0,"-",format(Sys.time(),"%y%m%d"),".Rmd", "\n", 
    env1$info$DocumentTitle0,"-dev",format(Sys.time(),"%y%m%d"),".Rmd", "\n", 
    env1$info$DocumentTitle0,"-clean",format(Sys.time(),"%y%m%d"),".Rmd", "\n", 
    sep="")
```
  
  
```{r env1-Path-NoEchoNoMsgNoResults, echo=FALSE, warning=TRUE, message=NA, results="hide"}
###### env1\$path ----  
# cat(" getwd() == "); dput(getwd())  
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
### env1\$path\$LastSourceEditorContext.path_filename_ext ====  
# *** Caution) In Rstudio Notebook, the path of the running Rmd file is set as the working directory~!!!
# env1$path$LastSourceEditorContext.path_filename_ext = rstudioapi::getSourceEditorContext()$path |> normalizePath(winslash="/",mustWork=NA) |> str_replace(fixed(getwd()|>normalizePath(winslash="/",mustWork=NA)), "") |> str_replace("^/", "")
env1$path$LastSourceEditorContext.path_filename_ext = rstudioapi::getSourceEditorContext()$path |> normalizePath(winslash="/",mustWork=NA) |> str_replace(fixed(env1$path$path1|>normalizePath(winslash="/",mustWork=NA)), "") |> str_replace("^/", "")
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
# env1$path$project_base = "Rproject_HEALS0215"
# env1$path$data_suffix = "_01"
# # env1$path$data_suffix = ""
# env1$path$project_suffix = "GJ3"
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
# env1$path$.path4read = file.path(env1$path$path0, paste0(env1$path$project_base, env1$path$data_suffix))
# env1$path$.path4write = file.path(env1$path$.path4read, paste0(env1$path$project_base, env1$path$data_suffix, env1$path$project_suffix))
env1$path$.path4read = ifelse(is.na(env1$path$path1), getwd(), env1$path$path1)
env1$path$.path4write = getwd()
.path4read  = env1$path$.path4read
.path4write = env1$path$.path4write
# cat(" > str(env1$path)\n"); str(env1$path, max.level = 1, give.attr = F)  

## @ env1 |> as.list() |> str(max.level = 2, give.attr = FALSE) ----  
"ls(all.names = TRUE, envir = .GlobalEnv) |> set_names() |> map(get) |> str(max.level = 1, give.attr = FALSE)" |> env1$f$f_CodeText.ECHO(EXECUTE = TRUE, deparse_cat = FALSE, LinePrefix4CodeText = "> ", LinePrefix4Output = "")
cat("    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    \n")
".tmp |> str(max.level = 1, give.attr = FALSE)" |> env1$f$f_CodeText.ECHO(EXECUTE = TRUE, deparse_cat = FALSE, LinePrefix4CodeText = "> ", LinePrefix4Output = "")
cat("    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    \n")
"env1 |> as.list() |> env1$f$f_list.str_by_element(max.level = 2, give.attr = FALSE)" |> env1$f$f_CodeText.ECHO(EXECUTE = TRUE, deparse_cat = FALSE, LinePrefix4CodeText = "> ", LinePrefix4Output = "")
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
# .filename.source.r = "f_DSN.Search.read.checkEntity" |> paste0(".source.r"); .subpath=r"()"|>str_replace_all("\\\\","/"); env1$f$f_sourcePath.execute_if_not_sourced(.subpath_filename.source.r = paste0(.subpath,ifelse(.subpath=="","","/"),.filename.source.r))
# if (getwd() != .path4write) warning("getwd() != .path4write  == ") else cat(" getwd() == .path4write == "); dput(.path4write)  
```
  
  
# __________|------  
# @@ MetaData) Read & Check ----  
```{r MetaData0-NoEchoNoMsgNoResults, echo=FALSE, warning=TRUE, message=NA, results="hide"}
## .GlobalEnv$MetaData = list() ====  
env1$path$LastSourceEditorContext.path_filename.MetaData.rds = env1$path$LastSourceEditorContext.path_filename_ext |> str_replace("\\.([[:alnum:]]+)$",".MetaData.rds")
if(file.exists(env1$path$LastSourceEditorContext.path_filename.MetaData.rds)) { 
    .MetaData0 = env1$path$LastSourceEditorContext.path_filename.MetaData.rds |> read_rds() 
}
if(!exists("MetaData", envir=.GlobalEnv)) { assign("MetaData", list(), envir=.GlobalEnv) }  
.parentname = "MetaData"
# for (.sublistname in c("tblVarName", "DSNs", "VarNames", "VarNames.select", "VarNames.filter", "VarNames.recode", "ModelList")) {
for (.sublistname in c("tblVarName", "DSNs", "VarNames", "VarNames.select", "ModelList")) {
    if(!.sublistname %in% names(.GlobalEnv[[.parentname]])) { .GlobalEnv[[.parentname]][[.sublistname]] = list() }
}

### # MetaData\$ModelList  ====   
.parentname = "MetaData"; 
.sublistname = "ModelList"; 
for (.sub2listname in c("time2DM", "time2HTN", "time2DL", "time2MetS")) {
    if(!.sub2listname %in% names(.GlobalEnv[[.parentname]][[.sublistname]])) { .GlobalEnv[[.parentname]][[.sublistname]] = list() }
}

### # MetaData\$VarNames  ====   
.parentname = "MetaData"; 
.sublistname = "VarNames"; 
for (.sub2listname in c("Event", "Mediator", "Exposure", "PMHx", "Tx", "FHx", "Exam", "Social", "Behavioral", "Unclassified", "Calculated")) {
    if(!.sub2listname %in% names(.GlobalEnv[[.parentname]][[.sublistname]])) { .GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]] = list() }
}

#### \$ MetaData\$VarNames\$Event  ====   
.parentname = "MetaData"; 
.sublistname = "VarNames"; 
.sub2listname = "Event"; 
for (.sub3listname in c("DM", "HTN", "DL", "MetS")) {
    if(!.sub3listname %in% names(.GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]]) ) { .GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]][[.sub3listname]] = list() }
}

#### \$ MetaData\$VarNames\$Mediator  ====   
.parentname = "MetaData"; 
.sublistname = "VarNames"; 
.sub2listname = "Mediator"; 
for (.sub3listname in c("BMI", "Waist")) {
    if(!.sub3listname %in% names(.GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]]) ) { .GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]][[.sub3listname]] = list() }
}

#### \$ MetaData\$VarNames\$Exposure  ====   
.parentname = "MetaData"; 
.sublistname = "VarNames"; 
.sub2listname = "Exposure"; 
for (.sub3listname in c("Exercise", "Diet", "Alcohol", "Smoking")) {
    if(!.sub3listname %in% names(.GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]]) ) { .GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]][[.sub3listname]] = list() }
}

#### \$ MetaData\$VarNames\$Demographic  ====   
.parentname = "MetaData"; 
.sublistname = "VarNames"; 
.sub2listname = "Social"; 
for (.sub3listname in c("Age", "Sex", "Income", "Education", "Residence", "Marriage")) {
    if(!.sub3listname %in% names(.GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]]) ) { .GlobalEnv[[.parentname]][[.sublistname]][[.sub2listname]][[.sub3listname]] = list() }
}

if(exists(".MetaData0", envir=.GlobalEnv)) { 
    ".MetaData0 |> str(max.level = 2, give.attr = TRUE)" %>% {cat("> ", ., "  \n", sep = "")}
    .MetaData0 |> str(max.level = 2, give.attr = TRUE)
} else { .MetaData0 = MetaData }
"MetaData |> str(max.level = 2, give.attr = TRUE)" %>% {cat("> ", ., "  \n", sep = "")}
MetaData |> str(max.level = 2, give.attr = TRUE)
```
  

## :: MetaData\$tblVarName = ----  
\$ MetaData\$tblVarName\$tblVarName.suffix = KoGES201806vars.CLEAN_TRIM ----      
```{r KoGES201806vars.CLEAN_TRIM-read.checkEntity-NoEcho, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
.DSN = "KoGES201806vars.CLEAN_TRIM"
assign(.DSN, read_rds(paste0(env1$path$path0,"/Rproject_KoGES_AA10030/",.DSN,".rds")))
MetaData$tblVarName$tblVarName.suffix = get(.DSN)
```
  
  
\$ MetaData\$tblVarName\$tblWAVE_VARNAME = KoGES201806vars_waves.rev.CLEAN ----   
```{r KoGES201806vars_waves.rev.CLEAN-read.checkEntity-NoEcho, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
.DSN = "KoGES201806vars_waves.rev.CLEAN"
assign(.DSN, read_rds(paste0(env1$path$path0,"/Rproject_KoGES_AA10030/",.DSN,".rds")))
MetaData$tblVarName$tblWAVE_VARNAME = get(.DSN)
```
  

#### \$tblVarName\$tblVarName = left_join() ----   
```{r tblVarName-join-NoEcho, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
# .DSN = "tblVarName"
# assign(.DSN, read_rds(paste0(env1$path$path0,"/Rproject_KoGES_AA10030/",.DSN,".rds")))
tblVarName = MetaData$tblVarName$tblWAVE_VARNAME |>
    # mutate(WAVE = paste0("A0", Wave) |> as.factor()) |>
    left_join(MetaData$tblVarName$tblVarName.suffix %>% select(VarName.suffix, ValueOptions), by="VarName.suffix") %>%
    mutate(VarName = WAVE_VARNAME, ValueOptions = ValueOptions %>% as.character())
tblVarName = tblVarName %>% mutate(
    ValueUnit = ifelse(VarType == "Continuous", ValueOptions %>% str_replace_all("[^(]*\\(.*\\) *", "") |> na_if(""), NA) %>% as.factor()
    # , VarDescription = ifelse(VarType == "Continuous", as.character(VarDescription) %>% paste0(" (",ValueUnit,")"), as.character(VarDescription)) %>% as.factor
)
tblVarName = tblVarName %>%
    select(VarName, WAVE_VARNAME, Wave, VarName.suffix, VarDescription, VarType, ValueOptions, ValueUnit, Select)
attributes(tblVarName)$n_distinct =
    list(nrow = tblVarName %>% nrow(),
         VarName = n_distinct(tblVarName$VarName),
         Wave = n_distinct(tblVarName$Wave),
         VarName.suffix = n_distinct(tblVarName$VarName.suffix) )
tblVarName |> str(max.level = 2, give.attr = TRUE)
MetaData$tblVarName$tblVarName = tblVarName
```
  
  
## :: MetaData\$VarNames = ----  
```{r MetaData.VarNames-NoEchoNoMsgNoResults, echo=FALSE, warning=TRUE, message=NA, results="hide"}
options(width=120)
### \% KoGES201806vars.CLEAN_TRIM \%>\% {cat(" > ",deparse(substitute(.))," |> str()","\\n", sep=""); str(.)} #----  
MetaData$tblVarName$tblVarName.suffix %>% {cat(" > ",deparse(substitute(.))," |> str()","  \n", sep=""); str(.)} #----  
MetaData$VarNames$VarName.suffix503 = KoGES201806vars.CLEAN_TRIM$VarName.suffix |> as.character() |> unique()
MetaData$VarNames$VarName.suffix503 |> str(max.level = 2, give.attr = TRUE)
### \% KoGES201806vars_waves.rev.CLEAN \%>\% {cat(" > ",deparse(substitute(.))," |> str()","\\n", sep=""); str(.)} #----  
MetaData$tblVarName$tblWAVE_VARNAME %>% {cat(" > ",deparse(substitute(.))," |> str()","  \n", sep=""); str(.)} #----  
MetaData$VarNames$WAVE_VARNAME3293 = KoGES201806vars_waves.rev.CLEAN$WAVE_VARNAME |> as.character() |> unique()
```
  
  



# __________|------  
# @@ DATA) mutate() ----  
```{r DATA-MUTATE-SYNC, eval=FALSE, include=FALSE}
paste0('### ->> Now synced to: "',dir(env1$path$path1, ".*\\.Rmd$", ignore.case = TRUE),'"  \n') |> cat(sep="")
```
## ->> Now synced to: ""  
# __________|------  

## \$ df_NewDMv3.CensorEND.n88.select293.NR.recode  
### :: VarName.suffix.regex = "A0[0-2]"
### :: DS.DNR = get(DSN) |> select(matches(VarName.suffix.regex))
#### \% |> select(matches("A0[0-3]")) ----  
#### \% |> env1\$f\$f_df.Table1byExposure.xlsx(VarNames4Exposure =  c("A01_BMI.5bins"))  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)
.path4read = paste0(env1$path$path0,"/Rproject_KoGES_AA10030")
# .path4read = paste0(env1$path$path0,"/Rproject_KoGES_AA10030/df_NewDMv3.CensorEND.n88.select971.NR.recode")
DSN = "df_NewDMv3.CensorEND.n88.select293.NR.recode"
# paste0(.path4read,"/",DSN,".rds") |> env1$f$f_DS_path_filename_ext.read.checkEntity()

env1$f$f_DSN.Search.read.checkEntity(DSN = DSN, ext = "rds", .path4read = .path4read, vec_candidate4ID = c("rowname", "rownum", "Num", "ID", "CompositeKey", "PERSON_ID", "RN_INDI", "NIHID"), BreathFirstSearch = TRUE, max_depth = 3, .width.cutoff=120-15, print2console = TRUE, return.output = TRUE, print.name.dput = FALSE, print.names.tidyeval = FALSE, VERBOSE = isTRUE(getOption("verbose")))

##________________________________________________________________________________  
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
VarName.suffix.regex =
    c(
        paste0("A0[1-5]_",
               c("WEIGHT", "HEIGHT",
                 "BMI.5bins")),
        # outer(c("delta", "pdelta"), 1:4, paste0),
        paste0("A02_", ".*",
               c("delta", "pdelta"),
               "1"),
        paste0("A03_", ".*",
               c("delta", "pdelta"),
               "1"),
        paste0("A03_", ".*",
               c("delta", "pdelta"),
               "2"),
        paste0("A05_", ".*",
               c("delta", "pdelta"),
               "4"),
        paste0("A00_",
               c("SEX")),
        "Female",
        paste0("A01_",
               c("EDATE", "AGE", "INCOME",
                 "WAIST", "HIP",
                 "BODYFAT", "OBDIG1", "OBDIG2", "OBDEG",
                 # "BP", "PULSE", "HTN_C", "HTNCU", "TREATD1", "DRUGHTCU", "FMHTN",
                 "PULSE", "HTN_C", "HTNCU", "DRUGHTCU", "FMHTN",
                 "HBA1C", "GLU0_TR", "GLU60_TR", "GLU120_TR", "DM_C", "DMCU", "TREATD2", "DRUGDMCU", "DRUGINSCU", "FMDM",
                 "INS0", "INS60", "INS120", 
                 # "PHYSTB", "PHYSIT", 
                 "PHYACTL", "PHYACTM", "PHYACTH",
                 "MET", "EXERCUR", "EXER", "EXERFQ", "EXERDU",
                 "BRF", "MEALRG", "AFTDNN", "OVEREAT", "MEALSPD", "
                 MEATFAT", 
                 # "CKOIL", "CKOILETC", "SPCOIL", "SPCOILETC", "RMEALFQA", "BMEALFQA", "SKPMEAL", "ALNMEALFQ", "FRFOILY", 
                 "B01", "B02", "B03", "B04", "B24", 
                 "DRINK", # "DRDU",
                 "SMOKE", "PACKYR", # "SMAG", "SMDU", "SMAM", "PSM", "PSMDU",
                 "TCHL_TR", "HDL_TR", "TRIGLY_TR", "LIPCU", 
                 "MICU", "CHFCU", "CADCU", "PVDCU", "TREATD8", "FMHEA",
                 # "R_GTP_TR", 
                 "CEVACU",
                 "KIDCU", "TREATD14"))
    ) %>% paste0(collapse="|")
VarName.suffix.regex %>% dput
DS.DNR = get(DSN) %>% select(matches(VarName.suffix.regex), matches("A0[0-2]")) %>%
    # select(matches("A00|A01|A04|A07"))
    # select(matches("A00|A01|A07"))
    select(matches("A0[0-3]"))
# DS.DNR = DS.DNR[sort(names(DS.DNR))]
DS.DNR = DS.DNR %>% mutate_if(function(vec) {is.numeric(vec) && n_distinct(vec) <= 10}, as.factor)
DS.DNR |> str(max.level = 2, give.attr = TRUE)
```




  
# __________|------  
https://cloud.r-project.org/web/packages/labelled/vignettes/intro_labelled.html 
# @@ Introduction to labelled  

## library(labelled)
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
if(!requireNamespace("labelled", quietly = TRUE)) install.packages("labelled")
.packagename = "labelled"; if (!paste0("package:",.packagename) %in% search()) {library(.packagename, character.only = TRUE)}
```

## ## Variable labels  

A variable label could be specified for any vector using `var_label()`.

### **ECHO** :: var_label(df$Var1) = "VarDescription1" ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
iris = datasets::iris
iris |> str(max.level = 2, give.attr = TRUE)
var_label(iris$Sepal.Length) <- "Length of sepal"
iris |> str(max.level = 2, give.attr = TRUE)
```

### **ECHO** :: var_label(df) <- list(Var1 = "VarDescription1", Var2 = "VarDescription2") ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
iris = datasets::iris
iris |> str(max.level = 2, give.attr = TRUE)
    var_label(iris) <- list(
      Petal.Length = "Length of petal",
      Petal.Width = "Width of Petal"
    )
iris |> str(max.level = 2, give.attr = TRUE)
```


You can display and search through variable names and labels with `look_for()`:
#### ECHO \% df |> look_for() ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
    look_for(iris)
```

    ##  pos variable     label           col_type missing values    
    ##  1   Sepal.Length —               dbl      0                 
    ##  2   Sepal.Width  —               dbl      0                 
    ##  3   Petal.Length Length of petal dbl      0                 
    ##  4   Petal.Width  Width of Petal  dbl      0                 
    ##  5   Species      —               fct      0       setosa    
    ##                                                    versicolor
    ##                                                    virginica

#### ECHO \% df |> look_for("varname_part") ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
    look_for(iris, "pet")
```

    ##  pos variable     label           col_type missing values
    ##  3   Petal.Length Length of petal dbl      0             
    ##  4   Petal.Width  Width of Petal  dbl      0

#### ECHO \% df |> look_for(details = FALSE) ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
    look_for(iris, details = FALSE)
```

    ##  pos variable     label          
    ##  1   Sepal.Length —              
    ##  2   Sepal.Width  —              
    ##  3   Petal.Length Length of petal
    ##  4   Petal.Width  Width of Petal 
    ##  5   Species      —


## ## Value labels  

### :: v = 
### ECHO :: labelled() ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
    v <- labelled(
      c(1, 2, 2, 2, 3, 9, 1, 3, 2, NA),
      c(yes = 1, no = 3, "don't know" = 8, refused = 9)
    )
    v
```

    ## <labelled<double>[10]>
    ##  [1]  1  2  2  2  3  9  1  3  2 NA
    ## 
    ## Labels:
    ##  value      label
    ##      1        yes
    ##      3         no
    ##      8 don't know
    ##      9    refused

#### **ECHO** :: val_labels(df$Var1) = c(LabelA = "ValueA", LabelB = "ValueB") ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
    val_labels(v) <- c(yes = 1, nno = 3, bug = 5)
    v
```

    ## <labelled<double>[10]>
    ##  [1]  1  2  2  2  3  9  1  3  2 NA
    ## 
    ## Labels:
    ##  value label
    ##      1   yes
    ##      3   nno
    ##      5   bug

### :: df =
#### **ECHO** :: val_labels(df) = list(Var1 = c(LabelA = "ValueA", LabelB = "ValueB"), Var2 = c(Label1 = 1, Label2 = 2)) ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
    df <- data.frame(v1 = 1:3, v2 = c(2, 3, 1), v3 = 3:1)
    val_labels(df) <- NULL
    val_labels(df) <- list(v1 = c(yes = 1, no = 3), v2 = c(a = 1, b = 2, c = 3))
    val_labels(df)
```

    ## $v1
    ## yes  no 
    ##   1   3 
    ## 
    ## $v2
    ## a b c 
    ## 1 2 3 
    ## 
    ## $v3
    ## NULL


# __________|------  
# @@ Rdev/00_base_program/f_vecNamed.swap.dev.Rmd  
# @@ Rdev/10_import_clean_datatype/11_metadata/f_chrNameValuePairs2vector.dev.Rmd  
# @@ Rdev/10_import_clean_datatype/16_categorical_labelled/env1$f$f_CodeBook_DS.lbl.dev.Rmd  
  
# __________|------  
# @@ SOURCE) ----  
## \% |> f_chrNameValuePairs2vector() ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)

##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
## :: f_chrNameValuePairs2vector =  ----  
# https://github.com/mkim0710/tidystat/blob/master/Rdev/10_import_clean_datatype/11_metadata/f_chrNameValuePairs2vector.dev.Rmd
.tmp$objectname = "f_chrNameValuePairs2vector"
.tmp$object = function(chrNameValuePairs, NameValuePair_separator = ",", Name_Value_separator = "=", vecNamed.swap = FALSE) {
    vec.NameValuePair = chrNameValuePairs %>% str_split(paste0("\\s*", NameValuePair_separator, "\\s*")) %>% unlist() 
    list.vec.Name_Value = vec.NameValuePair %>% str_split(paste0("\\s*", Name_Value_separator, "\\s*"))
    vecNamed = list.vec.Name_Value %>% map(~ set_names(c(.x[2]), .x[1])) %>% unlist()
    if (vecNamed.swap) vecNamed = names(vecNamed) |> setNames(vecNamed)
    return(vecNamed)    
}
#### \% |> f_function.load2env.internal(.tmp$objectname, env1_subenv_name) ---
.tmp$env1_subenv_name = "f"; env1$env.internal$f_function.load2env.internal(function_object = .tmp$object, function_name = .tmp$objectname, env1_subenv_name = .tmp$env1_subenv_name, show_packageStartupMessage = TRUE, RELOAD_FUNCTION = isTRUE(getOption("RELOAD_FUNCTION"))||isTRUE(getOption("DEVMODE")), runLoadedFunction = FALSE)

##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
f_chrNameValuePairs2vector = function(chrNameValuePairs, NameValuePair_separator = ",", Name_Value_separator = "=", vecNamed.swap = FALSE) {
    vec.NameValuePair = chrNameValuePairs %>% str_split(paste0("\\s*", NameValuePair_separator, "\\s*")) %>% unlist() 
    list.vec.Name_Value = vec.NameValuePair %>% str_split(paste0("\\s*", Name_Value_separator, "\\s*"))
    vecNamed = list.vec.Name_Value %>% map(~ set_names(c(.x[2]), .x[1])) %>% unlist()
    if (vecNamed.swap) vecNamed = names(vecNamed) |> setNames(vecNamed)
    return(vecNamed)    
}

```
  
  
### \% "ValueA=LabelA, ValueB=LabelB" |> ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
"ValueA=LabelA, ValueB=LabelB" |> env1$f$f_chrNameValuePairs2vector() %>% dput
"ValueA=LabelA, ValueB=LabelB" |> env1$f$f_chrNameValuePairs2vector(vecNamed.swap = TRUE) %>% dput

```


### \% "1=남자, 2=여자" |> ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
MetaData$tblVarName$tblVarName.suffix %>% filter(VarName.suffix == "SEX") %>% pull(ValueOptions) %>% as.character %>% dput
i.ValueOptions = MetaData$tblVarName$tblVarName.suffix %>% filter(VarName.suffix == "SEX") %>% pull(ValueOptions) %>% as.character
i.ValueOptions = "1=남자, 2=여자"
i.ValueOptions |> env1$f$f_chrNameValuePairs2vector(vecNamed.swap = TRUE) %>% dput
```




# __________|------  
# @@ START) dev ----  
```{r env0-NoEchoNoResults, echo=FALSE, results="hide"}
env0 = env1
```


## @ MetaData) Variables: demographics ----  
### # VarCategory \%in\% c("일반사항", "일반정보")  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
KoGES201806vars.CLEAN_TRIM |> dplyr::filter(VarCategory %in% c("일반사항", "일반정보")) |> 
    dplyr::select(Num, VarCategory, VarName.suffix, VarDescription, ValueOptions, Select) |> env1$f$f_df.print_byVar(VarCategory, n=99)
```


#### \% VarName.suffix |> str_detect("Sex"|>regex(ignore_case=TRUE))  
##### \% VarName.suffix \%in\% c("SEX")  
###### :: var_label(DS[[i.WAVE_VARNAME]]) = ----  
###### :: val_label(DS[[i.WAVE_VARNAME]]) = ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
# VarName.suffix.regex = "(SEX)"
# KoGES201806vars.CLEAN_TRIM.filter = KoGES201806vars.CLEAN_TRIM |> dplyr::filter(VarName.suffix |> str_detect(VarName.suffix.regex|>regex(ignore_case=TRUE)))
# KoGES201806vars.CLEAN_TRIM.filter$VarName.suffix |> as.character() |> deparse() |> cat("  \n", sep="")
# ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
VarName.suffix.selected = c("SEX")
# KoGES201806vars.CLEAN_TRIM.filter = KoGES201806vars.CLEAN_TRIM |> dplyr::filter(VarName.suffix %in% VarName.suffix.selected)
# VarName.suffix.selected |> deparse() |> cat("  \n", sep="")
# cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
tblVarName.filter = MetaData$tblVarName$tblWAVE_VARNAME |> dplyr::filter(VarName.suffix %in% VarName.suffix.selected) %>% select(Num, VarName.suffix, VarDescription, Wave, WAVE_VARNAME, VarType, Select) %>% 
    left_join(MetaData$tblVarName$tblVarName.suffix %>% select(VarName.suffix, ValueOptions), by="VarName.suffix")
tblVarName.filter
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
DS = get(DSN)
DS %>% select(any_of(tblVarName.filter$WAVE_VARNAME)) |> as_tibble() |> print(n=5)
.packagename = "labelled"; if (!paste0("package:",.packagename) %in% search()) {library(.packagename, character.only = TRUE)}
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
tblVarName.filter$VarDescription |> as.character() |> deparse() |> cat("  \n", sep="")
cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
for (i.WAVE_VARNAME in tblVarName.filter$WAVE_VARNAME) {
    var_label(DS[[i.WAVE_VARNAME]]) = tblVarName.filter %>% dplyr::filter(WAVE_VARNAME == i.WAVE_VARNAME) %>% pull(VarDescription) %>% as.character
}
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
tblVarName.filter$ValueOptions |> as.character() |> deparse() |> cat("  \n", sep="")
cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
.packagename = "labelled"; if (!paste0("package:",.packagename) %in% search()) {library(.packagename, character.only = TRUE)}
for (i.WAVE_VARNAME in tblVarName.filter$WAVE_VARNAME) {
    val_labels(DS[[i.WAVE_VARNAME]]) = tblVarName.filter %>% 
        filter(WAVE_VARNAME == i.WAVE_VARNAME) %>% 
        pull(ValueOptions) %>% as.character |> 
        env1$f$f_chrNameValuePairs2vector(vecNamed.swap = TRUE)
}
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> str(max.level = 2, give.attr = TRUE)
DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> as_tibble() |> print(n=5)
cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> mutate_all(as_factor) |> str(max.level = 2, give.attr = TRUE)
DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> mutate_all(as_factor) |> as_tibble() |> print(n=5)
```
  
  
##### \% VarName.suffix \%in\% c("AGE")  
###### :: var_label(DS[[i.WAVE_VARNAME]]) = ----  
###### :: val_label(DS[[i.WAVE_VARNAME]]) = ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
# VarName.suffix.regex = "(AGE)"
# KoGES201806vars.CLEAN_TRIM.filter = KoGES201806vars.CLEAN_TRIM |> dplyr::filter(VarName.suffix |> str_detect(VarName.suffix.regex|>regex(ignore_case=TRUE)))
# KoGES201806vars.CLEAN_TRIM.filter$VarName.suffix |> as.character() |> deparse() |> cat("  \n", sep="")
# ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
VarName.suffix.selected = c("AGE")
# KoGES201806vars.CLEAN_TRIM.filter = KoGES201806vars.CLEAN_TRIM |> dplyr::filter(VarName.suffix %in% VarName.suffix.selected)
# VarName.suffix.selected |> deparse() |> cat("  \n", sep="")
# cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
tblVarName.filter = MetaData$tblVarName$tblWAVE_VARNAME |> dplyr::filter(VarName.suffix %in% VarName.suffix.selected) %>% select(Num, VarName.suffix, VarDescription, Wave, WAVE_VARNAME, VarType, Select) %>% 
    left_join(MetaData$tblVarName$tblVarName.suffix %>% select(VarName.suffix, ValueOptions), by="VarName.suffix")
tblVarName.filter
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
DS = get(DSN)
DS %>% select(any_of(tblVarName.filter$WAVE_VARNAME)) |> as_tibble() |> print(n=5)
.packagename = "labelled"; if (!paste0("package:",.packagename) %in% search()) {library(.packagename, character.only = TRUE)}
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
tblVarName.filter$VarDescription |> as.character() |> deparse() |> cat("  \n", sep="")
cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
for (i.WAVE_VARNAME in tblVarName.filter$WAVE_VARNAME) {
    var_label(DS[[i.WAVE_VARNAME]]) = tblVarName.filter %>% dplyr::filter(WAVE_VARNAME == i.WAVE_VARNAME) %>% pull(VarDescription) %>% as.character
}
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
tblVarName.filter$ValueOptions |> as.character() |> deparse() |> cat("  \n", sep="")
cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
# library(labelled)
# for (i.WAVE_VARNAME in tblVarName.filter$WAVE_VARNAME) {
#     val_labels(DS[[i.WAVE_VARNAME]]) = tblVarName.filter %>% 
#         filter(WAVE_VARNAME == i.WAVE_VARNAME) %>% 
#         pull(ValueOptions) %>% as.character |> 
#         env1$f$f_chrNameValuePairs2vector(vecNamed.swap = TRUE)
# }
# cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
# DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> str(max.level = 2, give.attr = TRUE)
# DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> as_tibble() |> print(n=5)
# cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
# DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> mutate_all(as_factor) |> str(max.level = 2, give.attr = TRUE)
# DS %>% {attr(., "n_distinct") = NULL; attr(., "MetaData") = NULL; .} |> select(any_of(tblVarName.filter$WAVE_VARNAME)) |> mutate_all(as_factor) |> as_tibble() |> print(n=5)
```
    # Error in `vec_cast_named()`:
    # ! Can't convert `labels` <character> to match type of `x` <double>.
    # Backtrace:
    #  1. labelled::`val_labels<-`(...)
    #  2. labelled:::`val_labels<-.numeric`(...)
    #  3. haven::labelled(x, value, label = var_label(x))
    #  4. haven:::vec_cast_named(labels, x, x_arg = "labels", to_arg = "x")

###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```
  
  
###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```
  
  
###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```
  
  

# __________|------  
# @@ SOURCE) ----  
```{r .subpath_filename.source.r-NoEchoNoMsgNoResults, echo=FALSE, warning=TRUE, message=NA, results="hide"}
options(width=120)
options(DEVMODE = TRUE);  # isTRUE(getOption("DEVMODE"))
.subpath = "Rdev/10_import_clean_datatype/16_categorical_labelled"  
.sourcename_root = "f_CodeBook_DS.lbl"  
if(!exists(".sourcename_root") && exists(".filename.source.r")) .sourcename_root = .filename.source.r |> str_replace("\\.source\\.r$", "")
.filename.source.r = .sourcename_root |> paste0(".source.r")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# \% source( file.path(env1$path$source_base,.subpath_filename.source.r) ) ----
env1$f$f_sourcePath.execute_if_not_sourced(.subpath_filename.source.r = paste0(.subpath,ifelse(.subpath=="","","/"),.filename.source.r))
```
  
  
# __________|------  
# @@ START) function ----  
## *** Caution) convert lbl to fct (quite deterministic step) before select or recode or filter_n ~!!! ----  ##++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++  
## :: env1$env.internal$f_CodeBook_DS_VarName.lbl()  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

DS = get(DSN)
attributes(DS)$MetaData = NULL
# cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
env1$env.internal$f_CodeBook_DS_VarName.lbl(DS, "A00_SEX", tblVarName, vecNamed.swap = TRUE, output.select = TRUE) %>% as_tibble() %>% print(n=5)
env1$env.internal$f_CodeBook_DS_VarName.lbl(DS, "A00_SEX", tblVarName, vecNamed.swap = TRUE, output.select = TRUE) %>% str(maxlevel = 2)
cat("    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    \n")
env1$env.internal$f_CodeBook_DS_VarName.lbl(DS, paste0("A0", 1:2, "_AGE"), tblVarName, vecNamed.swap = TRUE, output.select = TRUE) %>% as_tibble() %>% print(n=5)
env1$env.internal$f_CodeBook_DS_VarName.lbl(DS, paste0("A0", 1:2, "_AGE"), tblVarName, vecNamed.swap = TRUE, output.select = TRUE) %>% str(maxlevel = 2)
```


## :: env1$f$f_CodeBook_DS.lbl()  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

DS = get(DSN)
# attributes(DS)$MetaData = NULL
# DS = DS %>% select(matches("SEX"))
# DS = DS %>% select(matches("^A00"))
# DS = DS %>% select(matches("^A0[0-1]")) %>% select(matches("AGE"))
# DS = DS %>% select(matches("^A0[0-1]"))
# DS = DS %>% env1$f$f_CodeBook_DS.lbl(tblVarName, vecNamed.swap = TRUE, VERBOSE = TRUE) 
DS.lbl = DS %>% env1$f$f_CodeBook_DS.lbl(tblVarName, vecNamed.swap = TRUE)
DS.lbl %>% select(matches("^A0[0-1]")) %>% {attributes(.)$MetaData = NULL; .} %>% as_tibble() %>% print(n=5)
DS.lbl %>% select(matches("^A0[0-1]")) %>% {attributes(.)$MetaData = NULL; .} %>% str(maxlevel = 2)
cat("    ________________________________________________________________________    \n")
DS.lbl.fct = DS.lbl %>% mutate_if(function(vec) is.character(vec) && labelled::is.labelled(vec), as_factor)
DS.lbl.fct %>% select(matches("^A0[0-1]")) %>% {attributes(.)$MetaData = NULL; .} %>% str(maxlevel = 2)
```
  
  
### DS.fct |> env1$f$f_CodeBook_DS.lbl()  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

DS = get(DSN)
# attributes(DS)$MetaData = NULL
# DS = DS %>% select(matches("SEX"))
# DS = DS %>% select(matches("^A00"))
# DS = DS %>% select(matches("^A0[0-1]")) %>% select(matches("AGE"))
# DS = DS %>% select(matches("^A0[0-1]"))
# DS = DS %>% env1$f$f_CodeBook_DS.lbl(tblVarName, vecNamed.swap = TRUE, VERBOSE = TRUE) 
DS.fct = DS %>% mutate_if(is.character, as.factor)
DS.fct |> str(max.level = 2, give.attr = TRUE)
DS.fct.lbl = DS.fct %>% env1$f$f_CodeBook_DS.lbl(tblVarName, vecNamed.swap = TRUE)
DS.fct.lbl %>% select(matches("^A0[0-1]")) %>% {attributes(.)$MetaData = NULL; .} %>% as_tibble() %>% print(n=5)
DS.fct.lbl %>% select(matches("^A0[0-1]")) %>% {attributes(.)$MetaData = NULL; .} %>% str(maxlevel = 2)
cat("    ________________________________________________________________________    \n")
DS.fct.lbl.fct = DS.fct.lbl %>% mutate_if(function(vec) is.character(vec) && labelled::is.labelled(vec), as_factor) 
DS.fct.lbl.fct %>% select(matches("^A0[0-1]")) %>% {attributes(.)$MetaData = NULL; .} %>% str(maxlevel = 2)
```



###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```
  
  
###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```
  
  
###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```
  
  


 
  
###### \% |> () ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)

```
  
  
###### \% |> () ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)

```
  
  
###### \% |> () ----  
```{r, echo=FALSE, results="markup", collapse=TRUE, paged.print=FALSE, comment="", R.options=list(width=120)}
options(width=120)

```
  
  
  
# __________|------  
# @@ END ----  
```{r END-NoEvalNoEchoNoMsgNoResults, eval=FALSE, echo=FALSE, warning=TRUE, message=NA, results="hide", collapse=TRUE, paged.print=FALSE}
##________________________________________________________________________________  
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
##++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++  
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
##________________________________________________________________________________  
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
# @@ END ----  
cat("    ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::    \n")
cat("    [][][][][][][][][][][][][][][][][][][][][][][][][][][][][][][][][][][][]    \n")
cat("    {}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}{}    \n")
cat("    ()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()    \n")
cat("    <><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>    \n")
cat("    HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH    \n")
cat("    OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO    \n")
cat("    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    \n")
cat("    VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV    \n")
cat("    WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW    \n")
cat("    -|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|    \n")
cat("    ________________________________________________________________________    \n")
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
cat("    ************************************************************************    \n")
cat("    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    \n")
cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
```
  
  
###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```

  
###### ECHO \% |> () ----  
```{r, echo=TRUE, results="markup", collapse=TRUE, paged.print=FALSE, comment="#", R.options=list(width=120)}
options(width=120)

```

  
  
```{r writeRDS-EvalNoEchoNoMsgNoResults, eval=TRUE, echo=FALSE, warning=TRUE, message=NA, results="hide"}
# __________|------  
## @ write_rds( get(.objectname), paste0(.path4write,ifelse(.path4write=="","","/"),.objectname,".rds",".xz"), compress = "xz", compression = 9L) |> system.time() |> round(3) |> unclass() |> deparse() |> cat("\n") ----
if (Sys.getenv("PARENT_RENDERING") != "YES") {    
    .path4write = .path4write %>% str_replace(fixed(env1$path$path1), "") %>% str_replace("^/", "")  # [][Rproject] makes an error in git bash
    if(exists("MetaData")) {
        # MetaData$DSNs |> names() |> paste0(collapse = "\n") |> cat("\n", sep="")
        cat("    ________________________________________________________________________    \n")
        for (DSN in names(MetaData$DSNs)) {    
            if(exists(DSN)) {
                assign(DSN, structure(get(DSN, envir = .GlobalEnv), MetaData = as.environment(MetaData)), envir = .GlobalEnv)
                if(is.null(attributes(.GlobalEnv[[DSN]])$DSN)) attributes(.GlobalEnv[[DSN]])$DSN = DSN
                if(attributes(.GlobalEnv[[DSN]])$DSN != DSN) attributes(.GlobalEnv[[DSN]])$DSN = DSN
                if (!is.null(attributes(attributes(.GlobalEnv[[DSN]])$DSN)$.path_file)) {
                    message( "attributes(attributes(",DSN,")$DSN)$.path_file == ",deparse(attributes(attributes(get(DSN))$DSN)$.path_file) )
                    env1$f$f_objectname.size.write_rds.git_lfs_track_add_f(.objectname = DSN, .path_file = attributes(attributes(.GlobalEnv[[DSN]])$DSN)$.path_file, createBACKUP = FALSE, EXECUTE = FALSE, path.size_files = TRUE, git_lfs_track = TRUE, git_add_f = TRUE)
                } else {
                    env1$f$f_objectname.size.write_rds.git_lfs_track_add_f(.objectname = DSN, .path4write = .path4write, createBACKUP = FALSE, EXECUTE = FALSE, path.size_files = TRUE, git_lfs_track = TRUE, git_add_f = TRUE)
                }
            } else {  message("!exists(",deparse(DSN),")")  }
            cat("    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    \n")
        }
    }
    # #++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    # .path_filename.xlsx = paste0(.path4write,ifelse(.path4write=="","","/"),.objectname,".xlsx")  ;  openxlsx2::write_xlsx(get(.objectname), file = .path_filename.xlsx, as_table=TRUE, table_style="none", row_names=TRUE, col_widths="auto", first_active_row=2, first_active_col=2) |> system.time() |> round(3) |> unclass() |> deparse() |> cat("\n")  ;  if (Sys.info()["sysname"] == "Linux") browseURL(.path_filename.xlsx) else openxlsx2::xl_open(.path_filename.xlsx)
    # #++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    # .path_filename.UTF8BOM.csv = paste0(.path4write,ifelse(.path4write=="","","/"),.objectname,".UTF8BOM.csv")
    # if (Sys.info()["sysname"] == "Windows") {
    #     readr::write_excel_csv(get(.objectname), file = .path_filename.UTF8BOM.csv) |> system.time() |> round(3) |> unclass() |> deparse() |> cat("\n")
    #     openxlsx2::xl_open(.path_filename.xlsx)
    # } else {
    #     readr::write_excel_csv(get(.objectname), file = .path_filename.UTF8BOM.csv|>paste0(".xz")) |> system.time() |> round(3) |> unclass() |> deparse() |> cat("\n")
    # }
    # #++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    # .path_filename.UTF8.csv.xz = paste0(.path4write,ifelse(.path4write=="","","/"),.objectname,".UTF8.csv.xz")
    # readr::write_csv(get(.objectname), file = .path_filename.UTF8.csv.xz) |> system.time() |> round(3) |> unclass() |> deparse() |> cat("\n")
}
if (Sys.getenv("PARENT_RENDERING") != "YES") {
    
}
##________________________________________________________________________________  
##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
DSN
DSN %>% paste0(".lbl")
DSN %>% paste0(".lbl.fct")
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
DS.lbl.fct %>% select(1) |> str(max.level = 2, give.attr = TRUE)
cat("    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    \n")
for (i.suffix in c(".lbl", ".lbl.fct")) {
    .objectname = DSN %>% paste0(i.suffix)
    .path_file = paste0(env1$path$path0,"/Rproject_KoGES_AA10030/",.objectname,".rds",".xz") 
    get(paste0("DS",i.suffix)) %>% env1$f$f_objectname.size.write_rds.git_lfs_track_add_f(.object = ., .objectname = .objectname, .path_file = .path_file, .path4write = NULL, .filename_ext4write = NULL, createBACKUP = FALSE, .BACKUP_to_path="-BACKUP", EXECUTE = TRUE, path.size_files = TRUE, git_lfs_track = FALSE, git_add_f = FALSE, CompressionMethod = "xz", VERBOSE = FALSE)
    cat("    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    \n")
}

```
  
    df_NewDMv3.CensorEND.n88.select293.NR.recode.lbl |> write_rds('/home/rstudio/Rproject_KoGES_AA10030/df_NewDMv3.CensorEND.n88.select293.NR.recode.lbl.rds.xz', compress = 'xz', compression = 9L) |> system.time()  
    env1$f$f_path.size_files(.path4read = '/home/rstudio/github_tidystat/Rdev/10_import_clean_datatype/16_categorical_labelled', regex4filename = 'df_NewDMv3.CensorEND.n88.select293.NR.recode.lbl')  
        ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    
    df_NewDMv3.CensorEND.n88.select293.NR.recode.lbl.fct |> write_rds('/home/rstudio/Rproject_KoGES_AA10030/df_NewDMv3.CensorEND.n88.select293.NR.recode.lbl.fct.rds.xz', compress = 'xz', compression = 9L) |> system.time()  
    env1$f$f_path.size_files(.path4read = '/home/rstudio/github_tidystat/Rdev/10_import_clean_datatype/16_categorical_labelled', regex4filename = 'df_NewDMv3.CensorEND.n88.select293.NR.recode.lbl.fct')  
        ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  
  
```{r createBACKUP, eval=TRUE, include=FALSE}
if (Sys.getenv("PARENT_RENDERING") != "YES") {
    # if (Sys.info()["sysname"] == "Windows") {
        env1$env.internal.attach$f_filename_ext.createBACKUP(BACKUP_from_path_filename_ext = rstudioapi::getSourceEditorContext()$path|>str_replace("\\.([[:alnum:]]+)$",".Rmd"), .BACKUP_to_path="-BACKUP", timeFormat="%y%m%d_%H", overwrite=TRUE)
        # env1$env.internal.attach$f_filename_ext.createBACKUP(BACKUP_from_path_filename_ext = rstudioapi::getSourceEditorContext()$path|>str_replace("\\.([[:alnum:]]+)$",".nb.html"), .BACKUP_to_path="-BACKUP", timeFormat="%y%m%d_%H", overwrite=TRUE)
    # }
}
```
  
  
```{r Render-NoEchoNoMsgNoResults, echo=FALSE, warning=TRUE, message=NA, results="hide"}
env1$path$LastSourceEditorContext.path_filename.pdf = env1$path$LastSourceEditorContext.path_filename_ext |> str_replace("\\.([[:alnum:]]+)$",".pdf") |> str_replace_all('[ <>()|\\:&;#?*\']', "-")
env1$path$LastSourceEditorContext.path_filename.html = env1$path$LastSourceEditorContext.path_filename_ext |> str_replace("\\.([[:alnum:]]+)$",".html") |> str_replace_all('[ <>()|\\:&;#?*\']', "-")
if (Sys.getenv("PARENT_RENDERING") != "YES") {
    if (Sys.info()["sysname"] == "Windows") {
        .tlmgr_installed_packages <- system2("tlmgr", args = c("info", "--list", "--only-installed"), stdout = TRUE)
        for (.font_name in c("roboto", "cascadia-code")) if(.tlmgr_installed_packages |> str_subset(.font_name) |> length() == 0) tinytex::tlmgr_install(.font_name)

        cat('Starting: rstudioapi::getSourceEditorContext()$path |> rmarkdown::render(output_dir = ',deparse(dirname(env1$path$LastSourceEditorContext.path_filename_ext)),', output_format = "pdf_document")  \n')
        Sys.setenv(PARENT_RENDERING = "YES"); env1$path$LastSourceEditorContext.path_filename_ext %>% {paste0(env1$path$path1,"/",.)} %>% {rmarkdown::render(input = .,output_dir = dirname(.), output_format = "pdf_document")}; Sys.setenv(PARENT_RENDERING = "NO")
        .path_file = env1$path$LastSourceEditorContext.path_filename.pdf %>% {paste0(env1$path$path1,"/",.)}
        env1$f$f_file.git_lfs_track_add_f(.path_file = .path_file, EXECUTE = FALSE)
        env1$env.internal.attach$f_filename_ext.createBACKUP(BACKUP_from_path_filename_ext = .path_file, .BACKUP_to_path="-BACKUP", timeFormat="%y%m%d_%H", overwrite=TRUE)
        try(env1$env.internal.attach$f_file_PDF.sumatra(.path_file))
    }
}
# env1$path$LastSourceEditorContext.path_filename_ext %>% {paste0(env1$path$path1,"/",.)} %>% {cat('  Sys.setenv(PARENT_RENDERING = "YES"); rmarkdown::render(input = ',deparse(.),', output_dir = ',deparse(dirname(.)),', output_format = "pdf_document"); Sys.setenv(PARENT_RENDERING = "NO")  \n', sep="")}; .path_file = env1$path$LastSourceEditorContext.path_filename.pdf %>% {paste0(env1$path$path1,"/",.)}; env1$f$f_file.git_lfs_track_add_f(.path_file = .path_file, EXECUTE = FALSE); cat('  env1$env.internal.attach$f_filename_ext.createBACKUP(BACKUP_from_path_filename_ext = ',deparse(.path_file),', .BACKUP_to_path="-BACKUP", timeFormat="%y%m%d_%H", overwrite=TRUE)  \n', sep=""); if (Sys.info()["sysname"] == "Windows") { cat('  env1$env.internal.attach$f_file_PDF.sumatra(',deparse(.path_file),')  \n', sep="") } else { cat('  browseURL(',deparse(.path_file),')  \n', sep="") }
# cat("    ________________________________________________________________________    \n")
env1$path$LastSourceEditorContext.path_filename_ext %>% {paste0(env1$path$path1,"/",.)} %>% {cat('  Sys.setenv(PARENT_RENDERING = "YES"); rmarkdown::render(input = ',deparse(.),', output_dir = ',deparse(dirname(.)),', output_format = "html_document"); Sys.setenv(PARENT_RENDERING = "NO")  \n', sep="")}; .path_file = env1$path$LastSourceEditorContext.path_filename.html %>% {paste0(env1$path$path1,"/",.)}; env1$f$f_file.git_lfs_track_add_f(.path_file = .path_file, EXECUTE = FALSE); cat('  env1$env.internal.attach$f_filename_ext.createBACKUP(BACKUP_from_path_filename_ext = ',deparse(.path_file),', .BACKUP_to_path="-BACKUP", timeFormat="%y%m%d_%H", overwrite=TRUE)  \n', sep=""); cat('  env1$env.internal.attach$f_URL.browse_in_edge_app(',deparse(.path_file),')  \n', sep="")
```
  
  
```{r gitCheckout-NoEchoNoMsgNoResults, echo=FALSE, warning=TRUE, message=NA, results="hide"}
env1$source[[basename(rstudioapi::getSourceEditorContext()$path)]] = rstudioapi::getSourceEditorContext()$path
env1$path$LastSourceEditorContext.path_filename.nb.html = env1$path$LastSourceEditorContext.path_filename_ext |> str_replace("\\.([[:alnum:]]+)$",".nb.html")
if (Sys.info()["sysname"] == "Windows" && Sys.getenv("PARENT_RENDERING") != "YES") { paste0('ping -n 5 127.0.0.1 > nul & "C:/Program Files (x86)/Microsoft/Edge/Application/msedge_proxy.exe" --app="',env1$path$LastSourceEditorContext.path_filename.nb.html %>% {paste0(env1$path$path1,"/",.)}|>normalizePath(winslash="/",mustWork=NA),'"') |> shell(wait=FALSE) } # else { browseURL(env1$path$LastSourceEditorContext.path_filename.nb.html %>% {paste0(env1$path$path1,"/",.)}) }
# paste0("https://github.com/mkim0710/",basename(getwd()),"/blob/main/",env1$path$LastSourceEditorContext.path_filename_ext) %>% paste0('"C:/Program Files (x86)/Microsoft/Edge/Application/msedge_proxy.exe" --app="',.,'"') |> system(intern=TRUE)
paste0("https://github.com/mkim0710/",basename(getwd()),"/blob/main/",env1$path$LastSourceEditorContext.path_filename_ext) %>% paste0('"C:/Program Files (x86)/Microsoft/Edge/Application/msedge_proxy.exe" --app="',.,'"') %>% paste0("'",.,"' |> system(intern=TRUE)") |> cat("  \n", sep="")
# paste0("https://github.com/mkim0710/",basename(getwd()),"/commits/main/",env1$path$LastSourceEditorContext.path_filename_ext) %>% paste0('"C:/Program Files (x86)/Microsoft/Edge/Application/msedge_proxy.exe" --app="',.,'"') |> system(intern=TRUE)
paste0("https://github.com/mkim0710/",basename(getwd()),"/commits/main/",env1$path$LastSourceEditorContext.path_filename_ext)  %>% paste0('"C:/Program Files (x86)/Microsoft/Edge/Application/msedge_proxy.exe" --app="',.,'"') %>% paste0("'",.,"' |> system(intern=TRUE)") |> cat("  \n", sep="")
cat("* To revert to the last commited file, run the following terminal command:  \n")
paste0( "git checkout -- ",shQuote(paste0(env1$path$path1,"/",env1$path$LastSourceEditorContext.path_filename_ext)) ) |> deparse() |> cat(" |> system(intern=TRUE)  \n", sep="")
paste0( "git checkout -- ",shQuote(paste0(env1$path$path1,"/",env1$path$LastSourceEditorContext.path_filename.nb.html)) ) |> deparse() |> cat(" |> system(intern=TRUE)  \n", sep="")
```
  
  
